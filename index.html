<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Rust WebAssembly è¨ˆç®—ä¾‹</title>
</head>
<body>
    <h1>Rust WebAssembly ã§ã®è¨ˆç®—ä¾‹</h1>
    <p>çµæœã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã§ã”ç¢ºèªãã ã•ã„ã€‚</p>

<script type="module">
    // ğŸ’¡ å¿…è¦ãªé–¢æ•°ã‚’ã™ã¹ã¦ä¸€ã¤ã® import æ–‡ã«ã¾ã¨ã‚ã‚‹
    import init, { xorshift32, generate_xorshift32_bulk } from './wasm_adder.js'; 

    // JSå´ã®çŠ¶æ…‹ï¼ˆã‚·ãƒ¼ãƒ‰å€¤ï¼‰
    let js_seed = 2463534242; 

    /**
     * Xorshift32 ã® JavaScript å®Ÿè£…
     */
    function jsXorshift32() {
        let x = js_seed;
        x ^= x << 13;
        x ^= x >> 17;
        x ^= x << 5;
        js_seed = x;
        return x >>> 0;
    }

    async function runWasm() {
        try {
            await init();

            const ITERATIONS = 10_000_000;
            
            console.log(`\n--- Wasm/JS ä¸€æ‹¬ä¹±æ•°ç”Ÿæˆãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ (${ITERATIONS.toLocaleString()}å›) ---`);

            // --- A. Wasmç‰ˆã®è¨ˆæ¸¬ (ä¸€æ‹¬å‡¦ç†) ---
            console.time('Wasm Bulk Time');
            const wasm_results = generate_xorshift32_bulk(ITERATIONS); 
            console.timeEnd('Wasm Bulk Time');
            console.log(`Wasmç”Ÿæˆé…åˆ—ã‚µã‚¤ã‚º: ${wasm_results.length.toLocaleString()}`); 

            // --- B. JSç‰ˆã®è¨ˆæ¸¬ (é…åˆ—å‡¦ç†) ---
            // Wasmã‹ã‚‰è¿”ã•ã‚ŒãŸæœ€çµ‚ã‚·ãƒ¼ãƒ‰ã‚’JSã®ã‚·ãƒ¼ãƒ‰ã«ã‚»ãƒƒãƒˆï¼ˆå…¬å¹³æ€§ã®ç¢ºä¿ï¼‰
            js_seed = wasm_results[wasm_results.length - 1]; 
            
            console.time('JavaScript Bulk Time');
            // é…åˆ—æ“ä½œã®ã‚³ã‚¹ãƒˆã‚’å…¬å¹³ã«ã™ã‚‹ãŸã‚ã€JSã‚‚é…åˆ—ã«pushã™ã‚‹
            const js_results = [];
            for (let i = 0; i < ITERATIONS; i++) {
                js_results.push(jsXorshift32());
            }
            console.timeEnd('JavaScript Bulk Time');
            console.log(`JSç”Ÿæˆé…åˆ—ã‚µã‚¤ã‚º: ${js_results.length.toLocaleString()}`);

            // æœ€çµ‚çµæœã®ç¢ºèª
            console.log(`\nãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å®Œäº†ã€‚WasmãŒJSã‚ˆã‚Šé«˜é€Ÿãªã¯ãšã§ã™ã€‚`);


        } catch (error) {
            console.error("WebAssemblyã®å®Ÿè¡Œä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:", error);
        }
    }

    runWasm();
</script>
</body>
</html>